<%- model_class = Infrastructure -%>
<div class="page-header">
  <h1><%=t 'infrastructures.infrastructure' %></h1>
  <%= breadcrumbs(@selected_client, @selected_project, nil) if current_user.master? %>
  <%= link_to t('infrastructures.return_to_projects'), projects_path, {class: "btn btn-small btn-link"} unless current_user.master? %>
</div>

<!-- component template -->
<script type="text/x-template" id="grid-template">
  <table>
    <thead>
      <tr>
        <th v-repeat="key: columns"
          v-on="click:sortBy(key)"
          v-class="active: sortKey == key">
          {{key | capitalize}}
          <span class="arrow"
            v-class="reversed[key] ? 'dsc' : 'asc'">
          </span>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr v-repeat="
        entry: data
        | filterBy filterKey
        | orderBy sortKey reversed[sortKey]">
        <td v-repeat="key: columns">
          {{entry[key]}}
        </td>
      </tr>
    </tbody>
  </table>
</script>

<!-- demo root element -->
<div id="demo">
  <form id="search">
    Search <input name="query" v-model="searchQuery">
  </form>
  <demo-grid
    data="{{gridData}}"
    columns="{{gridColumns}}"
    filter-key="{{searchQuery}}">
  </demo-grid>
</div>

<table class="table table-hover">
  <thead>
    <tr>
      <th><%= t 'infrastructures.stackname' %></th>
      <th><%= t 'infrastructures.region' %></th>
      <th><%= t 'infrastructures.keypair' %></th>
      <th><%= t 'common.actions' %></th>
    </tr>
  </thead>
  <tbody>
    <% @infrastructures.each do |infra| %>
      <tr class="infrastructure-row">
        <td><%= infra.stack_name %> </td>
        <td><%= infra.region %></td>
        <td><%= infra.keypairname || t('infrastructures.msg.no_keypair') %></td>
        <td>
          <%= button_show_infra(infra) %>

          <%= button_serverspecs(infra.id) %>

          <%= button_edit_infra(infra) %>
          <%= button_detach_stack(infra) %>
          <%= button_delete_stack(infra) %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="text-center">
  <%= paginate(@infrastructures) %>
</div>

<%= button_add_infra(@selected_project) %>

<div class="page-header"></div>

<%= render 'show' %>
